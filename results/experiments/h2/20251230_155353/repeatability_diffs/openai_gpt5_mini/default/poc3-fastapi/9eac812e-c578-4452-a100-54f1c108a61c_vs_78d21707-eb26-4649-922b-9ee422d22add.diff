--- 9eac812e-c578-4452-a100-54f1c108a61c
+++ 78d21707-eb26-4649-922b-9ee422d22add
@@ -1,31 +1,34 @@
 @@FILE:Dockerfile::backend/Dockerfile
-FROM python:3.12-slim
-
+FROM python:3.11-slim
+
+# Set working directory
 WORKDIR /app
 
 # Install build dependencies
-RUN apt-get update \
-    && apt-get install -y --no-install-recommends build-essential gcc libpq-dev \
-    && rm -rf /var/lib/apt/lists/*
-
-COPY requirements.txt ./requirements.txt
+RUN apt-get update && apt-get install -y --no-install-recommends gcc libpq-dev build-essential && rm -rf /var/lib/apt/lists/*
+
+# Copy requirements and install
+COPY requirements.txt ./
 RUN pip install --no-cache-dir -r requirements.txt
 
-COPY app ./app
-
+# Copy application code
+COPY ./app ./app
+
+# Expose port used by uvicorn
 EXPOSE 8000
 
+# Run the application with uvicorn
 CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
 @@FILE:Dockerfile::frontend/Dockerfile
+# Build stage
 FROM node:20-alpine AS build
 WORKDIR /app
 COPY package.json package-lock.json ./
-COPY tsconfig*.json ./
-COPY vite.config.* ./
-COPY src ./src
-COPY index.html ./
-RUN npm ci && npm run build
-
+RUN npm ci
+COPY . .
+RUN npm run build
+
+# Production image with nginx
 FROM nginx:stable-alpine
 COPY --from=build /app/dist /usr/share/nginx/html
 COPY nginx.conf /etc/nginx/conf.d/default.conf
@@ -37,7 +40,7 @@
 metadata:
   name: backend-config
 data:
-  DATABASE_URL: "postgresql://user:password@db:5432/dbname"
+  DATABASE_URL: postgresql://user:password@db:5432/dbname
 @@FILE:K8s::k8s/backend-deployment.yaml
 apiVersion: apps/v1
 kind: Deployment
@@ -59,6 +62,12 @@
           imagePullPolicy: IfNotPresent
           ports:
             - containerPort: 8000
+          env:
+            - name: DATABASE_URL
+              valueFrom:
+                configMapKeyRef:
+                  name: backend-config
+                  key: DATABASE_URL
           resources:
             requests:
               cpu: "100m"
@@ -66,23 +75,17 @@
             limits:
               cpu: "500m"
               memory: "512Mi"
-          env:
-            - name: DATABASE_URL
-              valueFrom:
-                configMapKeyRef:
-                  name: backend-config
-                  key: DATABASE_URL
           livenessProbe:
+            httpGet:
+              path: /
+              port: 8000
+            initialDelaySeconds: 10
+            periodSeconds: 10
+          readinessProbe:
             httpGet:
               path: /
               port: 8000
             initialDelaySeconds: 5
-            periodSeconds: 10
-          readinessProbe:
-            httpGet:
-              path: /
-              port: 8000
-            initialDelaySeconds: 2
             periodSeconds: 5
 @@FILE:K8s::k8s/backend-service.yaml
 apiVersion: v1
@@ -103,8 +106,8 @@
 metadata:
   name: frontend-config
 data:
-  VITE_API_URL: "/api"
-@@FILE:K8s::k8s/frontend-deployment-update.yaml
+  VITE_API_URL: https://poc3-fastapi.rasztabiga.me/api
+@@FILE:K8s::k8s/frontend-deployment.yaml
 apiVersion: apps/v1
 kind: Deployment
 metadata:
@@ -125,50 +128,28 @@
           imagePullPolicy: IfNotPresent
           ports:
             - containerPort: 80
-          resources:
-            requests:
-              cpu: "50m"
-              memory: "64Mi"
-            limits:
-              cpu: "200m"
-              memory: "256Mi"
-          env:
-            - name: VITE_API_URL
-              valueFrom:
-                configMapKeyRef:
-                  name: frontend-config
-                  key: VITE_API_URL
-@@FILE:K8s::k8s/frontend-deployment.yaml
-apiVersion: apps/v1
-kind: Deployment
-metadata:
-  name: frontend
-spec:
-  replicas: 1
-  selector:
-    matchLabels:
-      app: frontend
-  template:
-    metadata:
-      labels:
-        app: frontend
-    spec:
-      containers:
-        - name: frontend
-          image: frontend
-          imagePullPolicy: IfNotPresent
-          ports:
-            - containerPort: 80
-          resources:
-            requests:
-              cpu: "50m"
-              memory: "64Mi"
-            limits:
-              cpu: "200m"
-              memory: "256Mi"
           env:
             - name: VITE_API_URL
               value: "/api"
+          resources:
+            requests:
+              cpu: "100m"
+              memory: "128Mi"
+            limits:
+              cpu: "500m"
+              memory: "512Mi"
+          livenessProbe:
+            httpGet:
+              path: /
+              port: 80
+            initialDelaySeconds: 10
+            periodSeconds: 10
+          readinessProbe:
+            httpGet:
+              path: /
+              port: 80
+            initialDelaySeconds: 5
+            periodSeconds: 5
 @@FILE:K8s::k8s/frontend-service.yaml
 apiVersion: v1
 kind: Service
@@ -186,23 +167,24 @@
 apiVersion: networking.k8s.io/v1
 kind: Ingress
 metadata:
-  name: poc3-fastapi-ingress
+  name: notes-ingress
   annotations:
-    nginx.ingress.kubernetes.io/rewrite-target: /$1
+    nginx.ingress.kubernetes.io/rewrite-target: /$2
+    nginx.ingress.kubernetes.io/use-regex: "true"
 spec:
   rules:
     - host: poc3-fastapi.rasztabiga.me
       http:
         paths:
-          - path: /api
-            pathType: Prefix
+          - path: /api(/|$)(.*)
+            pathType: ImplementationSpecific
             backend:
               service:
                 name: backend
                 port:
                   number: 8000
-          - path: /
-            pathType: Prefix
+          - path: /(.*)
+            pathType: ImplementationSpecific
             backend:
               service:
                 name: frontend
@@ -214,32 +196,33 @@
 metadata:
   name: postgres-secret
 type: Opaque
-data:
-  username: dXNlcg==
-  password: cGFzc3dvcmQ=
+stringData:
+  POSTGRES_USER: user
+  POSTGRES_PASSWORD: password
+  POSTGRES_DB: dbname
 @@FILE:K8s::k8s/postgres-service.yaml
 apiVersion: v1
 kind: Service
 metadata:
   name: db
 spec:
+  selector:
+    app: db
   ports:
     - port: 5432
       targetPort: 5432
   clusterIP: None
-  selector:
-    app: db
 @@FILE:K8s::k8s/postgres-statefulset.yaml
 apiVersion: apps/v1
 kind: StatefulSet
 metadata:
   name: db
 spec:
+  selector:
+    matchLabels:
+      app: db
   serviceName: db
   replicas: 1
-  selector:
-    matchLabels:
-      app: db
   template:
     metadata:
       labels:
@@ -247,7 +230,8 @@
     spec:
       containers:
         - name: postgres
-          image: postgres:15-alpine
+          image: postgres:15
+          imagePullPolicy: IfNotPresent
           ports:
             - containerPort: 5432
           env:
@@ -255,17 +239,27 @@
               valueFrom:
                 secretKeyRef:
                   name: postgres-secret
-                  key: username
+                  key: POSTGRES_USER
             - name: POSTGRES_PASSWORD
               valueFrom:
                 secretKeyRef:
                   name: postgres-secret
-                  key: password
+                  key: POSTGRES_PASSWORD
             - name: POSTGRES_DB
-              value: dbname
+              valueFrom:
+                secretKeyRef:
+                  name: postgres-secret
+                  key: POSTGRES_DB
           volumeMounts:
             - name: postgres-data
               mountPath: /var/lib/postgresql/data
+          resources:
+            requests:
+              cpu: "100m"
+              memory: "256Mi"
+            limits:
+              cpu: "500m"
+              memory: "512Mi"
   volumeClaimTemplates:
     - metadata:
         name: postgres-data