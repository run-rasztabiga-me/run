--- dae883f0-60ea-4cdb-a626-851a70e13d50
+++ 36989946-2c24-4f81-8ccf-6e274697789d
@@ -1,43 +1,39 @@
 @@FILE:Dockerfile::backend/Dockerfile
 FROM python:3.11-slim
 
-# Set working directory
 WORKDIR /app
 
-# Install build dependencies
-RUN apt-get update && apt-get install -y --no-install-recommends build-essential gcc libpq-dev \
-    && rm -rf /var/lib/apt/lists/*
-
-# Copy requirements and install
-COPY backend/requirements.txt /app/requirements.txt
-RUN pip install --no-cache-dir -r /app/requirements.txt
-
-# Copy application code
-COPY backend/app /app/app
-COPY backend/ /app/backend
-
-ENV PYTHONUNBUFFERED=1
-ENV PORT=8000
+# Install build deps
+RUN apt-get update && apt-get install -y --no-install-recommends \
+    build-essential \
+    libpq-dev \
+  && rm -rf /var/lib/apt/lists/*
+
+COPY requirements.txt .
+RUN pip install --no-cache-dir -r requirements.txt
+
+COPY app ./app
 
 EXPOSE 8000
 
 CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
 @@FILE:Dockerfile::frontend/Dockerfile
 # Build stage
-FROM node:18-alpine AS builder
+FROM node:18-alpine AS build
 WORKDIR /app
 
-COPY frontend/package.json frontend/package-lock.json ./
+COPY package.json package-lock.json ./
 RUN npm ci
-
-COPY frontend/ .
+COPY . .
 RUN npm run build
 
-# Production image with nginx
+# Production stage - serve with nginx
 FROM nginx:stable-alpine
-COPY --from=builder /app/dist /usr/share/nginx/html
-COPY frontend/nginx.conf /etc/nginx/conf.d/default.conf
+COPY --from=build /app/dist /usr/share/nginx/html
+COPY nginx.conf /etc/nginx/conf.d/default.conf
+
 EXPOSE 80
+
 CMD ["nginx", "-g", "daemon off;"]
 @@FILE:K8s::k8s/backend-deployment.yaml
 apiVersion: apps/v1
@@ -56,7 +52,7 @@
     spec:
       containers:
         - name: backend
-          image: backend:latest
+          image: backend
           imagePullPolicy: IfNotPresent
           ports:
             - containerPort: 8000
@@ -64,7 +60,7 @@
             - name: DATABASE_URL
               valueFrom:
                 secretKeyRef:
-                  name: backend-secret
+                  name: postgres-secret
                   key: DATABASE_URL
           resources:
             requests:
@@ -85,14 +81,6 @@
               port: 8000
             initialDelaySeconds: 2
             periodSeconds: 5
-@@FILE:K8s::k8s/backend-secret.yaml
-apiVersion: v1
-kind: Secret
-metadata:
-  name: backend-secret
-type: Opaque
-stringData:
-  DATABASE_URL: postgresql://user:password@postgres:5432/dbname
 @@FILE:K8s::k8s/backend-service.yaml
 apiVersion: v1
 kind: Service
@@ -102,9 +90,9 @@
   selector:
     app: backend
   ports:
-    - protocol: TCP
-      port: 8000
+    - port: 8000
       targetPort: 8000
+      protocol: TCP
   type: ClusterIP
 @@FILE:K8s::k8s/frontend-deployment.yaml
 apiVersion: apps/v1
@@ -123,16 +111,16 @@
     spec:
       containers:
         - name: frontend
-          image: frontend:latest
+          image: frontend
           imagePullPolicy: IfNotPresent
           ports:
             - containerPort: 80
           resources:
             requests:
-              cpu: "50m"
-              memory: "64Mi"
+              cpu: "100m"
+              memory: "128Mi"
             limits:
-              cpu: "250m"
+              cpu: "300m"
               memory: "256Mi"
           livenessProbe:
             httpGet:
@@ -155,29 +143,22 @@
   selector:
     app: frontend
   ports:
-    - protocol: TCP
-      port: 80
+    - port: 80
       targetPort: 80
+      protocol: TCP
   type: ClusterIP
 @@FILE:K8s::k8s/ingress.yaml
 apiVersion: networking.k8s.io/v1
 kind: Ingress
 metadata:
-  name: notes-ingress
+  name: poc3-fastapi-ingress
   annotations:
-    nginx.ingress.kubernetes.io/rewrite-target: /$1
+    nginx.ingress.kubernetes.io/rewrite-target: /
 spec:
   rules:
     - host: poc3-fastapi.rasztabiga.me
       http:
         paths:
-          - path: /api
-            pathType: Prefix
-            backend:
-              service:
-                name: backend
-                port:
-                  number: 8000
           - path: /
             pathType: Prefix
             backend:
@@ -185,13 +166,6 @@
                 name: frontend
                 port:
                   number: 80
-@@FILE:K8s::k8s/postgres-configmap.yaml
-apiVersion: v1
-kind: ConfigMap
-metadata:
-  name: postgres-config
-data:
-  PGDATA: /var/lib/postgresql/data/pgdata
 @@FILE:K8s::k8s/postgres-pvc.yaml
 apiVersion: v1
 kind: PersistentVolumeClaim
@@ -203,40 +177,39 @@
   resources:
     requests:
       storage: 1Gi
-  # storageClassName: "microk8s-hostpath"
 @@FILE:K8s::k8s/postgres-secret.yaml
 apiVersion: v1
 kind: Secret
 metadata:
   name: postgres-secret
-type: Opaque
 stringData:
   POSTGRES_USER: user
   POSTGRES_PASSWORD: password
   POSTGRES_DB: dbname
+  DATABASE_URL: postgresql://user:password@postgres:5432/dbname
 @@FILE:K8s::k8s/postgres-service.yaml
 apiVersion: v1
 kind: Service
 metadata:
   name: postgres
 spec:
+  selector:
+    app: postgres
   ports:
     - port: 5432
       targetPort: 5432
-  selector:
-    app: postgres
-  type: ClusterIP
+  clusterIP: None
 @@FILE:K8s::k8s/postgres-statefulset.yaml
 apiVersion: apps/v1
 kind: StatefulSet
 metadata:
   name: postgres
 spec:
+  serviceName: "postgres"
+  replicas: 1
   selector:
     matchLabels:
       app: postgres
-  serviceName: postgres
-  replicas: 1
   template:
     metadata:
       labels:
@@ -245,6 +218,7 @@
       containers:
         - name: postgres
           image: postgres:15
+          imagePullPolicy: IfNotPresent
           ports:
             - containerPort: 5432
           env:
@@ -269,16 +243,15 @@
           resources:
             requests:
               cpu: "100m"
-              memory: "128Mi"
+              memory: "256Mi"
             limits:
               cpu: "500m"
-              memory: "512Mi"
+              memory: "1Gi"
   volumeClaimTemplates:
     - metadata:
         name: postgres-data
       spec:
-        accessModes: ["ReadWriteOnce"]
+        accessModes: [ "ReadWriteOnce" ]
         resources:
           requests:
             storage: 1Gi
-        # storageClassName: microk8s-hostpath