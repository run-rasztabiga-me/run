--- 6fa8c2f5-68ef-4960-a391-f909d089b967
+++ 28cd26c6-6181-4cf9-b69a-9a3f1da5a360
@@ -1,21 +1,48 @@
 @@FILE:Dockerfile::Dockerfile
+
+# Stage 1: Builder
 FROM node:20-alpine AS builder
+
 WORKDIR /app
-COPY package.json pnpm-lock.yaml* ./
+
+# Install pnpm
+RUN npm install -g pnpm
+
+# Copy package.json and pnpm-lock.yaml to install dependencies
+COPY package.json pnpm-lock.yaml ./ 
+COPY next.config.ts postcss.config.mjs tailwind.config.ts tsconfig.json components.json eslint.config.mjs wrangler.toml ./ 
+
 RUN pnpm install --frozen-lockfile
-COPY . .
+
+# Copy the rest of the application code
+COPY public ./public
+COPY src ./src
+
+# Build the Next.js application
 RUN pnpm run build
 
+# Stage 2: Runner
 FROM node:20-alpine AS runner
+
 WORKDIR /app
-ENV NODE_ENV production
+
+# Install pnpm
+RUN npm install -g pnpm
+
+# Copy production dependencies and build output from the builder stage
+COPY --from=builder /app/package.json ./package.json
+COPY --from=builder /app/public ./public
 COPY --from=builder /app/.next ./.next
-COPY --from=builder /app/node_modules ./node_modules
-COPY --from=builder /app/public ./public
-COPY package.json ./
+
+# Set environment variables for Next.js
+ENV NODE_ENV=production
+ENV PORT=3000
+
 EXPOSE 3000
+
 CMD ["pnpm", "start"]
 @@FILE:K8s::k8s/adsensedetective-deployment.yaml
+
 apiVersion: apps/v1
 kind: Deployment
 metadata:
@@ -40,11 +67,11 @@
             - containerPort: 3000
           resources:
             requests:
+              cpu: "100m"
               memory: "128Mi"
-              cpu: "100m"
             limits:
+              cpu: "500m"
               memory: "512Mi"
-              cpu: "500m"
 @@FILE:K8s::k8s/adsensedetective-ingress.yaml
 apiVersion: networking.k8s.io/v1
 kind: Ingress
@@ -53,6 +80,7 @@
   annotations:
     nginx.ingress.kubernetes.io/rewrite-target: /
 spec:
+  ingressClassName: public
   rules:
     - host: adsensedetective.rasztabiga.me
       http:
@@ -65,6 +93,7 @@
                 port:
                   number: 80
 @@FILE:K8s::k8s/adsensedetective-service.yaml
+
 apiVersion: v1
 kind: Service
 metadata: